import Link from 'next/link'
import Layout from '../components/Layout.js'
import {useContext, useEffect, useState} from 'react';
import UserContext from '../components/UserContext'
import AuthForm from "@/pages/auth-form";
import { createClient } from '@supabase/supabase-js'

const supabaseUrl = 'https://ougeuzlashhmrbiwqmqk.supabase.co'
const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY
const supabase = createClient(supabaseUrl, supabaseKey)

export default async function Page() {
    const {profile} = useContext(UserContext)
    const [data, setData] = useState(null);
    const [loading, setLoading] = useState(true);


    useEffect(() => {
        const fetchData = async () => {
            const { data, error } = await supabase
                .from('articles')
                .select('*');
            if (error) {
                console.error('Error fetching data: ', error);
            } else {
                setData(data);
            }
            setLoading(false);
        };

        fetchData();
    }, []);
    return (

        <Layout

            title=""
            description="Generated by create next app"
        >
            {profile && (
                <div>
                    {profile.username},
                </div>
            )}
            <h1 className='wt-title'>
                {data && data.length > 0 ? data[0].title : 'No articles found'}
            </h1>

            <ul>
                <li>
                    <Link href="/articles">
                        View our articles
                    </Link>
                </li>
                <li>
                    <Link href="/about">
                        About us
                    </Link>
                </li>
                <li>
                    <Link href="/contacts">
                        Contact us
                    </Link>
                </li>
            </ul>
            <br/>
            <br/>

            <div className="row">
                <div className="col-6">
                    <h1 className="header">Supabase Auth + Storage</h1>
                    <p className="">
                        Experience our Auth and Storage through a simple profile management example. Create a user
                        profile and upload an avatar image. Fast, simple, secure.
                    </p>
                </div>
                <div className="col-6 auth-widget">
                    <AuthForm/>
                </div>
            </div>


        </Layout>
    )
}
