import Link from 'next/link'
import Layout from '../components/Layout.js'
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;
const supabase = createClient(supabaseUrl, supabaseKey);

export default function Articles({articles}) {
  return (
    <Layout title="Articles" description="Generated by create next app">
      <h1 className='wt-title'>
        Web technologies articles
      </h1>
      <p className="italic font-bold my-5">Here are all the articles</p>
      <ul>
        {articles.map(article => (
          <li key={article.slug} className="my-5">
            <h2 className="font-bold mb-1">
              <Link href={`/articles/${article.slug}`}>{article.title}</Link>
            </h2>
            <p className="article-message">{article.message}</p>

            <p className="article-info">
              {article.author && `Written by ${article.author.firstname} ${article.author.lastname} - `}
              {new Date(article.created_at).toLocaleDateString()}
            </p>
          
          </li>
        ))}
      </ul>
    </Layout>
  )
}


export async function getStaticProps() {
  let articles = [];
  const { data, error } = await supabase
    .from('articles')
    .select(`
      *,
      author:contacts (
        firstname,
        lastname
      )
    `);
  if (!error && data) {
    console.log('Articles data:', data); 
    articles = data;
  } else {
    console.error('Error fetching articles:', error);
  }

  return {
    props: {
      articles: articles
    }
  }
}